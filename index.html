<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evo-Labor</title>
<style>
body { margin:0; overflow:hidden; background:#0a0f19; font-family:sans-serif; }
canvas { display:block; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
// ===============================
// Utility
// ===============================
const Utils = {
  lerp: (a,b,t)=>a+(b-a)*t,
  clamp:(v,min,max)=>Math.max(min,Math.min(max,v)),
  rand:(min,max)=>Math.random()*(max-min)+min,
  randInt:(max)=>Math.floor(Math.random()*max),
  choice:(arr)=>arr[Math.floor(Math.random()*arr.length)]
};

// ===============================
// Canvas Engine
// ===============================
class Engine {
  constructor(canvas){
    this.canvas = canvas;
    this.ctx = canvas.getContext("2d");
    this.resize();
    window.addEventListener("resize", ()=>this.resize());
  }
  resize(){
    this.canvas.width = window.innerWidth;
    this.canvas.height = window.innerHeight;
  }
  clear(){
    this.ctx.fillStyle="#0a0f19";
    this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);
  }
}

// ===============================
// DNA
// ===============================
class DNA {
  constructor(genes){
    this.genes = [...genes];
  }
  mutate(){
    const idx = Utils.randInt(this.genes.length);
    this.genes[idx] += Utils.choice([-1,1]) * 0.55;
    this.genes[idx] = Utils.clamp(this.genes[idx],0.2,5);
    return idx;
  }
  clone(){
    return new DNA(this.genes);
  }
}

// ===============================
// Creature Renderer
// ===============================
class Creature {
  constructor(dna){
    this.dna = dna;
  }

  draw(ctx,x,y,scale=1,color="rgba(0,255,200,0.8)"){
    const g = this.dna.genes;
    ctx.save();
    ctx.translate(x,y);
    ctx.scale(scale,scale);
    ctx.strokeStyle=color;
    ctx.lineWidth=4;

    // torso
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(0,30);
    ctx.stroke();

    // head
    let headSize = 10 + g[8]*10;
    ctx.beginPath();
    ctx.arc(0,-10-headSize/2,headSize/2,0,Math.PI*2);
    ctx.stroke();

    const limb = (sx,sy,ul,ll,ua,la)=>{
      const ux = sx + Math.sin(ua)*ul;
      const uy = sy + Math.cos(ua)*ul;
      ctx.beginPath();
      ctx.moveTo(sx,sy);
      ctx.lineTo(ux,uy);
      ctx.lineTo(
        ux + Math.sin(ua+la)*ll,
        uy + Math.cos(ua+la)*ll
      );
      ctx.stroke();
    };

    for(let side of [-1,1]){
      limb(0,5,g[0]*12,g[1]*12,g[4]*side,g[6]*side);
      limb(0,30,g[2]*12,g[3]*12,g[5]*side,g[7]*side);
    }

    ctx.restore();
  }
}

// ===============================
// Evolution System
// ===============================
class Evolution {
  constructor(){
    this.baseGenes=[2,1.5,2.5,2,0.4,0.4,0.6,0.3,0.8];
    this.currentDNA=new DNA(this.baseGenes);
    this.creature=new Creature(this.currentDNA);
  }
  next(){
    const newDNA=this.currentDNA.clone();
    newDNA.mutate();
    this.currentDNA=newDNA;
    this.creature=new Creature(newDNA);
  }
}

// ===============================
// App
// ===============================
const engine=new Engine(document.getElementById("canvas"));
const evo=new Evolution();

window.addEventListener("click",()=>evo.next());

function loop(){
  engine.clear();
  evo.creature.draw(
    engine.ctx,
    engine.canvas.width/2,
    engine.canvas.height/2,
    1.6
  );
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
